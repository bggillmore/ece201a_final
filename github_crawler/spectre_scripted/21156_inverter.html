<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>inverter &mdash; TheSyDeKick 1.12_RC documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=d8314b78"></script>
        <script src="../_static/doctools.js?v=888ff710"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            TheSyDeKick
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../introduction.html">Introduction to TheSyDeKick</a></li>
<li class="toctree-l1"><a class="reference internal" href="../thesdk/sections.html">Thesdk core classes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rtl/sections.html">RTL interface classes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../spice/sections.html">Spice simulator interface classess</a></li>
<li class="toctree-l1"><a class="reference internal" href="../inverter/sections.html">Inverter class</a></li>
<li class="toctree-l1"><a class="reference internal" href="../inverter_testbench/sections.html">Inverter testbench class</a></li>
<li class="toctree-l1"><a class="reference internal" href="../inverter_tests/sections.html">Inverter tests class</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ads/sections.html">ADS interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ads_template/sections.html">ADS template class</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bootcamp/bootcamp.html">Bootcamp</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../documentation_instructions.html">Documentation instructions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../indices_and_tables.html">Indices and tables</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">TheSyDeKick</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Module code</a></li>
      <li class="breadcrumb-item active">inverter</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for inverter</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">========</span>
<span class="sd">Inverter</span>
<span class="sd">========</span>

<span class="sd">Inverter model template The System Development Kit</span>
<span class="sd">Used as a template for all TheSyDeKick Entities.</span>

<span class="sd">Current docstring documentation style is Numpy</span>
<span class="sd">https://numpydoc.readthedocs.io/en/latest/format.html</span>

<span class="sd">For reference of the markup syntax</span>
<span class="sd">https://docutils.sourceforge.io/docs/user/rst/quickref.html</span>

<span class="sd">This text here is to remind you that documentation is important.</span>
<span class="sd">However, youu may find it out the even the documentation of this </span>
<span class="sd">entity may be outdated and incomplete. Regardless of that, every day </span>
<span class="sd">and in every way we are getting better and better :).</span>

<span class="sd">Initially written by Marko Kosunen, marko.kosunen@aalto.fi, 2017.</span>


<span class="sd">Role of section &#39;if __name__==&quot;__main__&quot;&#39;</span>
<span class="sd">--------------------------------------------</span>

<span class="sd">This section is for self testing and interfacing of this class. The content of</span>
<span class="sd">it is fully up to designer. You may use it for example to test the</span>
<span class="sd">functionality of the class by calling it as ``pyhon3 __init__.py`` or you may</span>
<span class="sd">define how it handles the arguments passed during the invocation. In this</span>
<span class="sd">example it is used as a complete self test script for all the simulation models</span>
<span class="sd">defined for the inverter. </span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="s1">&#39;../../thesdk&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="p">):</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="s1">&#39;../../thesdk&#39;</span><span class="p">))</span>

<span class="kn">from</span> <span class="nn">thesdk</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">rtl</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">spice</span> <span class="kn">import</span> <span class="o">*</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<div class="viewcode-block" id="inverter">
<a class="viewcode-back" href="../inverter_tests/sections.html#inverter.inverter">[docs]</a>
<span class="k">class</span> <span class="nc">inverter</span><span class="p">(</span><span class="n">rtl</span><span class="p">,</span><span class="n">spice</span><span class="p">,</span><span class="n">thesdk</span><span class="p">):</span>

<div class="viewcode-block" id="inverter.__init__">
<a class="viewcode-back" href="../inverter_tests/sections.html#inverter.inverter.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">*</span><span class="n">arg</span><span class="p">):</span> 
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Inverter parameters and attributes</span>
<span class="sd">            Parameters</span>
<span class="sd">            ----------</span>
<span class="sd">                *arg : </span>
<span class="sd">                If any arguments are defined, the first one should be the parent instance</span>

<span class="sd">            Attributes</span>
<span class="sd">            ----------</span>
<span class="sd">            proplist : array_like</span>
<span class="sd">                List of strings containing the names of attributes whose values are to be copied </span>
<span class="sd">                from the parent</span>

<span class="sd">            Rs : float</span>
<span class="sd">                Sampling rate [Hz] of which the input values are assumed to change. Default: 100.0e6</span>

<span class="sd">            vdd : float</span>
<span class="sd">                Supply voltage [V] for inverter analog simulation. Default 1.0.</span>

<span class="sd">            IOS : Bundle</span>
<span class="sd">                Members of this bundle are the IO&#39;s of the entity. See documentation of thsdk package.</span>
<span class="sd">                Default members defined as</span>

<span class="sd">                self.IOS.Members[&#39;A&#39;]=IO() # Pointer for input data</span>
<span class="sd">                self.IOS.Members[&#39;Z&#39;]= IO() # pointer for oputput data</span>
<span class="sd">                self.IOS.Members[&#39;control_write&#39;]= IO() # Piter for control IO for rtl simulations</span>

<span class="sd">            model : string</span>
<span class="sd">                Default &#39;py&#39; for Python. See documentation of thsdk package for more details.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">print_log</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;I&#39;</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="s1">&#39;Initializing </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="vm">__name__</span><span class="p">))</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">proplist</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Rs&#39;</span><span class="p">,</span> <span class="s1">&#39;vdd&#39;</span><span class="p">]</span> <span class="c1"># Properties that can be propagated from parent</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Rs</span> <span class="o">=</span> <span class="mf">100e6</span> <span class="c1"># Sampling frequency</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vdd</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">IOS</span><span class="o">.</span><span class="n">Members</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">IO</span><span class="p">()</span> <span class="c1"># Pointer for input data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">IOS</span><span class="o">.</span><span class="n">Members</span><span class="p">[</span><span class="s1">&#39;Z&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">IO</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">IOS</span><span class="o">.</span><span class="n">Members</span><span class="p">[</span><span class="s1">&#39;CLK&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">IO</span><span class="p">()</span> <span class="c1"># Test clock for spice simulations</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">IOS</span><span class="o">.</span><span class="n">Members</span><span class="p">[</span><span class="s1">&#39;A_OUT&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">IO</span><span class="p">()</span> <span class="c1"># Test output for the input A</span>
        <span class="c1">##Analog output for inverter for analog simulation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">IOS</span><span class="o">.</span><span class="n">Members</span><span class="p">[</span><span class="s1">&#39;Z_ANA&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">IO</span><span class="p">()</span>
        <span class="c1">## For Extracting rising edges from the output waveform</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">IOS</span><span class="o">.</span><span class="n">Members</span><span class="p">[</span><span class="s1">&#39;Z_RISE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">IO</span><span class="p">()</span>
        <span class="c1">## Extracting values of A and Z at falling edges of CLK in decimal format (integer, in this case 0 or 1)</span>
        <span class="c1">## The clock signal can be any node voltage in the simulation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">IOS</span><span class="o">.</span><span class="n">Members</span><span class="p">[</span><span class="s1">&#39;A_DIG&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">IO</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">IOS</span><span class="o">.</span><span class="n">Members</span><span class="p">[</span><span class="s1">&#39;control_write&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">IO</span><span class="p">()</span> <span class="c1"># File for control is created in controller</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="s1">&#39;py&#39;</span> <span class="c1"># Can be set externally, but is not propagated</span>

        <span class="c1"># this copies the parameter values from the parent based on self.proplist</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">parent</span><span class="o">=</span><span class="n">arg</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">copy_propval</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">proplist</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">=</span><span class="n">parent</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">init</span><span class="p">()</span></div>


<div class="viewcode-block" id="inverter.init">
<a class="viewcode-back" href="../inverter_tests/sections.html#inverter.inverter.init">[docs]</a>
    <span class="k">def</span> <span class="nf">init</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Method to re-initialize the structure if the attribute values are changed after creation.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span> <span class="c1">#Currently nothing to add</span></div>


<div class="viewcode-block" id="inverter.main">
<a class="viewcode-back" href="../inverter_tests/sections.html#inverter.inverter.main">[docs]</a>
    <span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39; The main python description of the operation. Contents fully up to designer, however, the </span>
<span class="sd">        IO&#39;s should be handled bu following this guideline:</span>
<span class="sd">        </span>
<span class="sd">        To isolate the internal processing from IO connection assigments, </span>
<span class="sd">        The procedure to follow is</span>
<span class="sd">        1) Assign input data from input to local variable</span>
<span class="sd">        2) Do the processing</span>
<span class="sd">        3) Assign local variable to output</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">inval</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">IOS</span><span class="o">.</span><span class="n">Members</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">Data</span>
        <span class="n">out</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">inval</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">par</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">IOS</span><span class="o">.</span><span class="n">Members</span><span class="p">[</span><span class="s1">&#39;Z&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">Data</span><span class="o">=</span><span class="n">out</span></div>


<div class="viewcode-block" id="inverter.run">
<a class="viewcode-back" href="../inverter_tests/sections.html#inverter.inverter.run">[docs]</a>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">*</span><span class="n">arg</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39; The default name of the method to be executed. This means: parameters and attributes </span>
<span class="sd">            control what is executed if run method is executed. By this we aim to avoid the need of </span>
<span class="sd">            documenting what is the execution method. It is always self.run. </span>

<span class="sd">            Parameters</span>
<span class="sd">            ----------</span>
<span class="sd">            *arg :</span>
<span class="sd">                The first argument is assumed to be the queue for the parallel processing defined in the parent, </span>
<span class="sd">                and it is assigned to self.queue and self.par is set to True. </span>
<span class="sd">        </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">==</span><span class="s1">&#39;py&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span> 
            <span class="c1"># This defines contents of modelsim control file executed when interactive_rtl = True</span>
            <span class="c1"># Interactive control files</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">==</span> <span class="s1">&#39;icarus&#39;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">==</span> <span class="s1">&#39;ghdl&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">interactive_control_contents</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                    set io_facs [list] </span>
<span class="s2">                    lappend io_facs &quot;tb_inverter.A&quot;</span>
<span class="s2">                    lappend io_facs &quot;tb_inverter.Z&quot; </span>
<span class="s2">                    lappend io_facs &quot;tb_inverter.clock&quot;</span>
<span class="s2">                    gtkwave::addSignalsFromList $io_facs </span>
<span class="s2">                    gtkwave::/Time/Zoom/Zoom_Full</span>
<span class="s2">                &quot;&quot;&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">interactive_control_contents</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                    add wave </span><span class="se">\\</span>
<span class="s2">                    sim/:tb_inverter:A </span><span class="se">\\</span>
<span class="s2">                    sim/:tb_inverter:initdone </span><span class="se">\\</span>
<span class="s2">                    sim/:tb_inverter:clock </span><span class="se">\\</span>
<span class="s2">                    sim/:tb_inverter:Z</span>
<span class="s2">                    run -all</span>
<span class="s2">                    wave zoom full</span>
<span class="s2">                &quot;&quot;&quot;</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">==</span> <span class="s1">&#39;ghdl&#39;</span><span class="p">:</span>
                <span class="c1"># With this structure you can control the signals to be dumped to VCD </span>
                <span class="c1">#pass</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">simulator_control_contents</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;version = 1.1  # Optional</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="o">+</span> <span class="s2">&quot;/tb_inverter/A</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="o">+</span> <span class="s2">&quot;/tb_inverter/Z</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="o">+</span> <span class="s2">&quot;/tb_inverter/clock</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">==</span> <span class="s1">&#39;sv&#39;</span><span class="p">:</span> 
                <span class="bp">self</span><span class="o">.</span><span class="n">simulator_control_contents</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;vcd file </span><span class="si">%s</span><span class="s2">/inverter_dump.vcd</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rtlsimpath</span><span class="p">)</span>
                <span class="o">+</span> <span class="s2">&quot;vcd add -r *</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="o">+</span> <span class="s2">&quot;vcd on</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="o">+</span> <span class="s2">&quot;run -all</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="o">+</span> <span class="s2">&quot;quit</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;sv&#39;</span><span class="p">,</span> <span class="s1">&#39;icarus&#39;</span><span class="p">]:</span>
                <span class="c1"># Verilog simulation options here</span>
                <span class="n">_</span><span class="o">=</span><span class="n">rtl_iofile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="nb">dir</span><span class="o">=</span><span class="s1">&#39;in&#39;</span><span class="p">,</span> <span class="n">iotype</span><span class="o">=</span><span class="s1">&#39;sample&#39;</span><span class="p">,</span> <span class="n">ionames</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">],</span> <span class="n">datatype</span><span class="o">=</span><span class="s1">&#39;sint&#39;</span><span class="p">)</span> <span class="c1"># IO file for input A</span>
                <span class="n">f</span><span class="o">=</span><span class="n">rtl_iofile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span> <span class="nb">dir</span><span class="o">=</span><span class="s1">&#39;out&#39;</span><span class="p">,</span> <span class="n">iotype</span><span class="o">=</span><span class="s1">&#39;sample&#39;</span><span class="p">,</span> <span class="n">ionames</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Z&#39;</span><span class="p">],</span> <span class="n">datatype</span><span class="o">=</span><span class="s1">&#39;sint&#39;</span><span class="p">)</span>
                <span class="c1"># This is to avoid sampling time confusion with Icarus</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lang</span> <span class="o">==</span> <span class="s1">&#39;sv&#39;</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">rtl_io_sync</span><span class="o">=</span><span class="s1">&#39;@(negedge clock)&#39;</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">lang</span> <span class="o">==</span> <span class="s1">&#39;vhdl&#39;</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">rtl_io_sync</span><span class="o">=</span><span class="s1">&#39;falling_edge(clock)&#39;</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">rtlparameters</span><span class="o">=</span><span class="nb">dict</span><span class="p">([</span> <span class="p">(</span><span class="s1">&#39;g_Rs&#39;</span><span class="p">,(</span><span class="s1">&#39;real&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Rs</span><span class="p">)),])</span> <span class="c1"># Defines the sample rate</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">run_rtl</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">IOS</span><span class="o">.</span><span class="n">Members</span><span class="p">[</span><span class="s1">&#39;Z&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">Data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">IOS</span><span class="o">.</span><span class="n">Members</span><span class="p">[</span><span class="s1">&#39;Z&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">Data</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">==</span><span class="s1">&#39;vhdl&#39;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">==</span> <span class="s1">&#39;ghdl&#39;</span><span class="p">:</span>
                <span class="c1"># VHDL simulation options here</span>
                <span class="n">_</span><span class="o">=</span><span class="n">rtl_iofile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="nb">dir</span><span class="o">=</span><span class="s1">&#39;in&#39;</span><span class="p">,</span> <span class="n">iotype</span><span class="o">=</span><span class="s1">&#39;sample&#39;</span><span class="p">,</span> <span class="n">ionames</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">])</span> <span class="c1"># IO file for input A</span>
                <span class="n">f</span><span class="o">=</span><span class="n">rtl_iofile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span> <span class="nb">dir</span><span class="o">=</span><span class="s1">&#39;out&#39;</span><span class="p">,</span> <span class="n">iotype</span><span class="o">=</span><span class="s1">&#39;sample&#39;</span><span class="p">,</span> <span class="n">ionames</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Z&#39;</span><span class="p">],</span> <span class="n">datatype</span><span class="o">=</span><span class="s1">&#39;int&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lang</span> <span class="o">==</span> <span class="s1">&#39;sv&#39;</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">rtl_io_sync</span><span class="o">=</span><span class="s1">&#39;@(negedge clock)&#39;</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">lang</span> <span class="o">==</span> <span class="s1">&#39;vhdl&#39;</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">rtl_io_sync</span><span class="o">=</span><span class="s1">&#39;falling_edge(clock)&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rtlparameters</span><span class="o">=</span><span class="nb">dict</span><span class="p">([</span> <span class="p">(</span><span class="s1">&#39;g_Rs&#39;</span><span class="p">,(</span><span class="s1">&#39;real&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Rs</span><span class="p">)),])</span> <span class="c1"># Defines the sample rate</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">run_rtl</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">IOS</span><span class="o">.</span><span class="n">Members</span><span class="p">[</span><span class="s1">&#39;Z&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">Data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">IOS</span><span class="o">.</span><span class="n">Members</span><span class="p">[</span><span class="s1">&#39;Z&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">Data</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;eldo&#39;</span><span class="p">,</span><span class="s1">&#39;spectre&#39;</span><span class="p">,</span><span class="s1">&#39;ngspice&#39;</span><span class="p">]:</span>

                <span class="c1"># Creating a clock signal, which is used for testing the sample output features</span>
                <span class="n">_</span><span class="o">=</span><span class="n">spice_iofile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;CLK&#39;</span><span class="p">,</span> <span class="nb">dir</span><span class="o">=</span><span class="s1">&#39;in&#39;</span><span class="p">,</span> <span class="n">iotype</span><span class="o">=</span><span class="s1">&#39;sample&#39;</span><span class="p">,</span> <span class="n">ionames</span><span class="o">=</span><span class="s1">&#39;CLK&#39;</span><span class="p">,</span> <span class="n">rs</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Rs</span><span class="p">,</span> \
                               <span class="n">vhi</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">vdd</span><span class="p">,</span> <span class="n">trise</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Rs</span><span class="o">*</span><span class="mi">8</span><span class="p">),</span> <span class="n">tfall</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Rs</span><span class="o">*</span><span class="mi">8</span><span class="p">))</span>
                <span class="c1"># Sample type input</span>
                <span class="n">_</span><span class="o">=</span><span class="n">spice_iofile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="nb">dir</span><span class="o">=</span><span class="s1">&#39;in&#39;</span><span class="p">,</span> <span class="n">iotype</span><span class="o">=</span><span class="s1">&#39;sample&#39;</span><span class="p">,</span> <span class="n">ionames</span><span class="o">=</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="n">rs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Rs</span><span class="p">,</span> \
                               <span class="n">vhi</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">vdd</span><span class="p">,</span> <span class="n">trise</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Rs</span><span class="o">*</span><span class="mi">4</span><span class="p">),</span> <span class="n">tfall</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Rs</span><span class="o">*</span><span class="mi">4</span><span class="p">))</span>

                <span class="c1"># These are helper IOS for analog simulation</span>
                <span class="n">_</span><span class="o">=</span><span class="n">spice_iofile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Z_ANA&#39;</span><span class="p">,</span> <span class="nb">dir</span><span class="o">=</span><span class="s1">&#39;out&#39;</span><span class="p">,</span> <span class="n">iotype</span><span class="o">=</span><span class="s1">&#39;event&#39;</span><span class="p">,</span> <span class="n">sourcetype</span><span class="o">=</span><span class="s1">&#39;V&#39;</span><span class="p">,</span> <span class="n">ionames</span><span class="o">=</span><span class="s1">&#39;Z&#39;</span><span class="p">)</span>
                
                <span class="c1"># Sample type output</span>
                <span class="c1"># Clock is used to sample the waveform in analog simulation</span>
                <span class="n">_</span><span class="o">=</span><span class="n">spice_iofile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span> <span class="nb">dir</span><span class="o">=</span><span class="s1">&#39;out&#39;</span><span class="p">,</span> <span class="n">iotype</span><span class="o">=</span><span class="s1">&#39;sample&#39;</span><span class="p">,</span> <span class="n">ionames</span><span class="o">=</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span> <span class="n">trigger</span><span class="o">=</span><span class="s1">&#39;CLK&#39;</span><span class="p">,</span> \
                               <span class="n">vth</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">vdd</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="n">edgetype</span><span class="o">=</span><span class="s1">&#39;rising&#39;</span><span class="p">,</span><span class="n">ioformat</span><span class="o">=</span><span class="s1">&#39;dec&#39;</span><span class="p">)</span>
                

                <span class="c1"># Saving the analog waveform of the input as well</span>
                <span class="n">_</span><span class="o">=</span><span class="n">spice_iofile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;A_OUT&#39;</span><span class="p">,</span> <span class="nb">dir</span><span class="o">=</span><span class="s1">&#39;out&#39;</span><span class="p">,</span> <span class="n">iotype</span><span class="o">=</span><span class="s1">&#39;event&#39;</span><span class="p">,</span> <span class="n">sourcetype</span><span class="o">=</span><span class="s1">&#39;V&#39;</span><span class="p">,</span> <span class="n">ionames</span><span class="o">=</span><span class="s1">&#39;A&#39;</span><span class="p">)</span>

                <span class="c1"># For Extracting rising edges from the output waveform</span>
                <span class="n">_</span><span class="o">=</span><span class="n">spice_iofile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Z_RISE&#39;</span><span class="p">,</span> <span class="nb">dir</span><span class="o">=</span><span class="s1">&#39;out&#39;</span><span class="p">,</span> <span class="n">iotype</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="n">sourcetype</span><span class="o">=</span><span class="s1">&#39;V&#39;</span><span class="p">,</span> <span class="n">ionames</span><span class="o">=</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span> \
                               <span class="n">edgetype</span><span class="o">=</span><span class="s1">&#39;rising&#39;</span><span class="p">,</span><span class="n">vth</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">vdd</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>


                <span class="c1">## Extracting values of A and Z at falling edges of CLK in decimal format (integer, in this case 0 or 1)</span>
                <span class="c1">## The clock signal can be any node voltage in the simulation</span>
                <span class="n">_</span><span class="o">=</span><span class="n">spice_iofile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;A_DIG&#39;</span><span class="p">,</span> <span class="nb">dir</span><span class="o">=</span><span class="s1">&#39;out&#39;</span><span class="p">,</span> <span class="n">iotype</span><span class="o">=</span><span class="s1">&#39;sample&#39;</span><span class="p">,</span> <span class="n">ionames</span><span class="o">=</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="n">trigger</span><span class="o">=</span><span class="s1">&#39;CLK&#39;</span><span class="p">,</span> \
                               <span class="n">vth</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">vdd</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="n">edgetype</span><span class="o">=</span><span class="s1">&#39;rising&#39;</span><span class="p">,</span><span class="n">ioformat</span><span class="o">=</span><span class="s1">&#39;dec&#39;</span><span class="p">)</span>

                <span class="c1"># Multithreading, options and parameters</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nproc</span> <span class="o">=</span> <span class="mi">2</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">spiceoptions</span> <span class="o">=</span> <span class="p">{</span>
                            <span class="s1">&#39;eps&#39;</span><span class="p">:</span> <span class="s1">&#39;1e-6&#39;</span>
                        <span class="p">}</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">spiceparameters</span> <span class="o">=</span> <span class="p">{</span>
                            <span class="s1">&#39;exampleparam&#39;</span><span class="p">:</span> <span class="s1">&#39;0&#39;</span>
                        <span class="p">}</span>

                <span class="c1"># Defining library options</span>
                <span class="c1"># Path to model libraries needs to be defined in TheSDK.config as</span>
                <span class="c1"># either ELDOLIBFILE or SPECTRELIBFILE. In this case, no model libraries</span>
                <span class="c1"># will be included (assuming these variables are not defined). The</span>
                <span class="c1"># temperature will be set regardless.</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">spicecorner</span> <span class="o">=</span> <span class="p">{</span>
                            <span class="s1">&#39;corner&#39;</span><span class="p">:</span> <span class="s1">&#39;top_tt&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;temp&#39;</span><span class="p">:</span> <span class="mi">27</span><span class="p">,</span>
                        <span class="p">}</span>

                <span class="c1"># Example of defining supplies (not used here because the example inverter has no supplies)</span>
                <span class="n">_</span><span class="o">=</span><span class="n">spice_dcsource</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;supply&#39;</span><span class="p">,</span><span class="n">value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">vdd</span><span class="p">,</span><span class="n">pos</span><span class="o">=</span><span class="s1">&#39;VDD&#39;</span><span class="p">,</span><span class="n">neg</span><span class="o">=</span><span class="s1">&#39;VSS&#39;</span><span class="p">,</span><span class="n">extract</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">_</span><span class="o">=</span><span class="n">spice_dcsource</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;ground&#39;</span><span class="p">,</span><span class="n">value</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">pos</span><span class="o">=</span><span class="s1">&#39;VSS&#39;</span><span class="p">,</span><span class="n">neg</span><span class="o">=</span><span class="s1">&#39;0&#39;</span><span class="p">)</span>

                <span class="c1"># Adding a resistor between VDD and VSS to demonstrate power consumption extraction</span>
                <span class="c1"># This also demonstrates how to inject manual commands in to the testbench</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">==</span><span class="s1">&#39;spectre&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">spicemisc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;simulator lang=spice&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">spicemisc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Rtest VDD VSS 2000&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">==</span><span class="s1">&#39;spectre&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">spicemisc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;simulator lang=spectre&#39;</span><span class="p">)</span>
                
                <span class="c1"># Plotting nodes for interactive waveform viewing.</span>
                <span class="c1"># Spectre also supported, but without &#39;v()&#39; specifiers.</span>
                <span class="c1"># i.e. plotlist = [&#39;A&#39;,&#39;Z&#39;]</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">==</span> <span class="s1">&#39;eldo&#39;</span><span class="p">:</span>
                    <span class="n">plotlist</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;v(A)&#39;</span><span class="p">,</span><span class="s1">&#39;v(Z)&#39;</span><span class="p">]</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">==</span> <span class="s1">&#39;spectre&#39;</span><span class="p">:</span>
                    <span class="n">plotlist</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="s1">&#39;Z&#39;</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">plotlist</span> <span class="o">=</span> <span class="p">[]</span>

                <span class="c1"># Simulation command</span>
                <span class="n">_</span><span class="o">=</span><span class="n">spice_simcmd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">sim</span><span class="o">=</span><span class="s1">&#39;tran&#39;</span><span class="p">,</span><span class="n">plotlist</span><span class="o">=</span><span class="n">plotlist</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">run_spice</span><span class="p">()</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">par</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">IOS</span><span class="o">.</span><span class="n">Members</span><span class="p">)</span></div>


<div class="viewcode-block" id="inverter.define_io_conditions">
<a class="viewcode-back" href="../inverter_tests/sections.html#inverter.inverter.define_io_conditions">[docs]</a>
    <span class="k">def</span> <span class="nf">define_io_conditions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;This overloads the method called by run_rtl method. It defines the read/write conditions for the files</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lang</span> <span class="o">==</span> <span class="s1">&#39;sv&#39;</span><span class="p">:</span>
            <span class="c1"># Input A is read to verilog simulation after &#39;initdone&#39; is set to 1 by controller</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">iofile_bundle</span><span class="o">.</span><span class="n">Members</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">rtl_io_condition</span><span class="o">=</span><span class="s1">&#39;initdone&#39;</span>
            <span class="c1"># Output is read to verilog simulation when all of the outputs are valid, </span>
            <span class="c1"># and after &#39;initdone&#39; is set to 1 by controller</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">iofile_bundle</span><span class="o">.</span><span class="n">Members</span><span class="p">[</span><span class="s1">&#39;Z&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">rtl_io_condition_append</span><span class="p">(</span><span class="n">cond</span><span class="o">=</span><span class="s1">&#39;&amp;&amp; initdone&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">lang</span> <span class="o">==</span> <span class="s1">&#39;vhdl&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">iofile_bundle</span><span class="o">.</span><span class="n">Members</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">rtl_io_condition</span><span class="o">=</span><span class="s1">&#39;(initdone = </span><span class="se">\&#39;</span><span class="s1">1</span><span class="se">\&#39;</span><span class="s1">)&#39;</span>
            <span class="c1"># Output is read to verilog simulation when all of the outputs are valid, </span>
            <span class="c1"># and after &#39;initdone&#39; is set to 1 by controller</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">iofile_bundle</span><span class="o">.</span><span class="n">Members</span><span class="p">[</span><span class="s1">&#39;Z&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">rtl_io_condition_append</span><span class="p">(</span><span class="n">cond</span><span class="o">=</span><span class="s1">&#39;and initdone = </span><span class="se">\&#39;</span><span class="s1">1</span><span class="se">\&#39;</span><span class="s1">&#39;</span><span class="p">)</span></div>
</div>


<span class="k">if</span> <span class="vm">__name__</span><span class="o">==</span><span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">argparse</span>
    <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
    <span class="kn">from</span> <span class="nn">inverter</span> <span class="kn">import</span> <span class="o">*</span>
    <span class="kn">from</span> <span class="nn">inverter.controller</span> <span class="kn">import</span> <span class="n">controller</span> <span class="k">as</span> <span class="n">inverter_controller</span>
    <span class="kn">from</span> <span class="nn">inverter.signal_source</span> <span class="kn">import</span> <span class="n">signal_source</span>
    <span class="kn">from</span> <span class="nn">inverter.signal_plotter</span> <span class="kn">import</span> <span class="n">signal_plotter</span>
    <span class="kn">import</span> <span class="nn">pdb</span>

    <span class="c1"># Implement argument parser</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s1">&#39;Parse selectors&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--show&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;show&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">bool</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="s1">&#39;?&#39;</span><span class="p">,</span> <span class="n">const</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> 
            <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">help</span><span class="o">=</span><span class="s1">&#39;Show figures on screen&#39;</span><span class="p">)</span>
    <span class="n">args</span><span class="o">=</span><span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>

    <span class="n">length</span><span class="o">=</span><span class="mi">2</span><span class="o">**</span><span class="mi">8</span>
    <span class="n">rs</span><span class="o">=</span><span class="mf">100e6</span>
    <span class="n">lang</span><span class="o">=</span><span class="s1">&#39;sv&#39;</span>
    <span class="c1">#Testbench vhdl</span>
    <span class="c1">#lang=&#39;vhdl&#39;</span>
    <span class="n">controller</span><span class="o">=</span><span class="n">inverter_controller</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="n">lang</span><span class="p">)</span>
    <span class="n">controller</span><span class="o">.</span><span class="n">Rs</span><span class="o">=</span><span class="n">rs</span>
    <span class="c1">#controller.reset()</span>
    <span class="c1">#controller.step_time()</span>
    <span class="n">controller</span><span class="o">.</span><span class="n">start_datafeed</span><span class="p">()</span>
    <span class="c1">#models=[&#39;py&#39;,&#39;sv&#39;,&#39;icarus&#39;, &#39;ghdl&#39;, &#39;vhdl&#39;,&#39;eldo&#39;,&#39;spectre&#39;, &#39;ngspice&#39;]</span>
    <span class="c1">#By default, we set only open souce simulators</span>
    <span class="n">models</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;py&#39;</span><span class="p">,</span> <span class="s1">&#39;icarus&#39;</span><span class="p">,</span> <span class="s1">&#39;ghdl&#39;</span><span class="p">,</span> <span class="s1">&#39;ngspice&#39;</span><span class="p">]</span>
    <span class="c1"># Here we instantiate the signal source</span>
    <span class="n">duts</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">plotters</span><span class="o">=</span><span class="p">[]</span>
    <span class="c1">#Here we construct the &#39;testbench&#39;</span>
    <span class="n">s_source</span><span class="o">=</span><span class="n">signal_source</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">models</span><span class="p">:</span>
        <span class="c1"># Create an inverter</span>
        <span class="n">d</span><span class="o">=</span><span class="n">inverter</span><span class="p">()</span>
        <span class="n">duts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> 
        <span class="n">d</span><span class="o">.</span><span class="n">model</span><span class="o">=</span><span class="n">model</span>
        <span class="k">if</span> <span class="n">model</span> <span class="o">==</span> <span class="s1">&#39;ghdl&#39;</span><span class="p">:</span>
            <span class="n">d</span><span class="o">.</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;vhdl&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">d</span><span class="o">.</span><span class="n">lang</span><span class="o">=</span><span class="n">lang</span>
        <span class="n">d</span><span class="o">.</span><span class="n">Rs</span><span class="o">=</span><span class="n">rs</span>
        <span class="c1">#d.preserve_rtlfiles = True</span>
        <span class="c1"># Enable debug messages</span>
        <span class="c1">#d.DEBUG = True</span>
        <span class="c1"># Run simulations in interactive modes to monitor progress/results</span>
        <span class="c1">#d.interactive_spice=True</span>
        <span class="c1">#d.interactive_rtl=True</span>
        <span class="c1"># Preserve the IO files or simulator files for debugging purposes</span>
        <span class="c1">#d.preserve_iofiles = True</span>
        <span class="c1">#d.preserve_spicefiles = True</span>
        <span class="c1"># Save the entity state after simulation</span>
        <span class="c1">#d.save_state = True</span>
        <span class="c1">#d.save_database = True</span>
        <span class="c1"># Optionally load the state of the most recent simulation</span>
        <span class="c1">#d.load_state = &#39;latest&#39;</span>
        <span class="c1"># This connects the input to the output of the signal source</span>
        <span class="n">d</span><span class="o">.</span><span class="n">IOS</span><span class="o">.</span><span class="n">Members</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">s_source</span><span class="o">.</span><span class="n">IOS</span><span class="o">.</span><span class="n">Members</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span>
        <span class="c1"># This connects the clock to the output of the signal source</span>
        <span class="n">d</span><span class="o">.</span><span class="n">IOS</span><span class="o">.</span><span class="n">Members</span><span class="p">[</span><span class="s1">&#39;CLK&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">s_source</span><span class="o">.</span><span class="n">IOS</span><span class="o">.</span><span class="n">Members</span><span class="p">[</span><span class="s1">&#39;clk&#39;</span><span class="p">]</span>
        <span class="n">d</span><span class="o">.</span><span class="n">IOS</span><span class="o">.</span><span class="n">Members</span><span class="p">[</span><span class="s1">&#39;control_write&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">controller</span><span class="o">.</span><span class="n">IOS</span><span class="o">.</span><span class="n">Members</span><span class="p">[</span><span class="s1">&#39;control_write&#39;</span><span class="p">]</span>
        <span class="c1">## Add plotters</span>
        <span class="n">p</span><span class="o">=</span><span class="n">signal_plotter</span><span class="p">()</span>
        <span class="n">plotters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> 
        <span class="n">p</span><span class="o">.</span><span class="n">plotmodel</span><span class="o">=</span><span class="n">d</span><span class="o">.</span><span class="n">model</span>
        <span class="n">p</span><span class="o">.</span><span class="n">plotvdd</span><span class="o">=</span><span class="n">d</span><span class="o">.</span><span class="n">vdd</span>
        <span class="n">p</span><span class="o">.</span><span class="n">Rs</span> <span class="o">=</span> <span class="n">rs</span>
        <span class="n">p</span><span class="o">.</span><span class="n">IOS</span><span class="o">.</span><span class="n">Members</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">d</span><span class="o">.</span><span class="n">IOS</span><span class="o">.</span><span class="n">Members</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">]</span>
        <span class="n">p</span><span class="o">.</span><span class="n">IOS</span><span class="o">.</span><span class="n">Members</span><span class="p">[</span><span class="s1">&#39;Z&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">d</span><span class="o">.</span><span class="n">IOS</span><span class="o">.</span><span class="n">Members</span><span class="p">[</span><span class="s1">&#39;Z&#39;</span><span class="p">]</span>
        <span class="n">p</span><span class="o">.</span><span class="n">IOS</span><span class="o">.</span><span class="n">Members</span><span class="p">[</span><span class="s1">&#39;A_OUT&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">d</span><span class="o">.</span><span class="n">IOS</span><span class="o">.</span><span class="n">Members</span><span class="p">[</span><span class="s1">&#39;A_OUT&#39;</span><span class="p">]</span>
        <span class="n">p</span><span class="o">.</span><span class="n">IOS</span><span class="o">.</span><span class="n">Members</span><span class="p">[</span><span class="s1">&#39;A_DIG&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">d</span><span class="o">.</span><span class="n">IOS</span><span class="o">.</span><span class="n">Members</span><span class="p">[</span><span class="s1">&#39;A_DIG&#39;</span><span class="p">]</span>
        <span class="n">p</span><span class="o">.</span><span class="n">IOS</span><span class="o">.</span><span class="n">Members</span><span class="p">[</span><span class="s1">&#39;Z_ANA&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">d</span><span class="o">.</span><span class="n">IOS</span><span class="o">.</span><span class="n">Members</span><span class="p">[</span><span class="s1">&#39;Z_ANA&#39;</span><span class="p">]</span>
        <span class="n">p</span><span class="o">.</span><span class="n">IOS</span><span class="o">.</span><span class="n">Members</span><span class="p">[</span><span class="s1">&#39;Z_RISE&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">d</span><span class="o">.</span><span class="n">IOS</span><span class="o">.</span><span class="n">Members</span><span class="p">[</span><span class="s1">&#39;Z_RISE&#39;</span><span class="p">]</span>
        

    <span class="c1"># Here we run the instances</span>
    <span class="n">s_source</span><span class="o">.</span><span class="n">run</span><span class="p">()</span> <span class="c1"># Creates the data to the output</span>
    <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">duts</span><span class="p">:</span>
        <span class="n">d</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>
        <span class="n">d</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">plotters</span><span class="p">:</span>
        <span class="n">p</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>
        <span class="n">p</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>

     <span class="c1">#This is here to keep the images visible</span>
     <span class="c1">#For batch execution, you should comment the following line </span>
    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">show</span><span class="p">:</span>
       <span class="nb">input</span><span class="p">()</span>
    <span class="c1">#This is to have exit status for succesfuulexecution</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2019 TheSyDeKick Community.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>